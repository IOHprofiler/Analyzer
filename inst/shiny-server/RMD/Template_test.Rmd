---
title: "Automatic report"
author: "IOHprofiler"
date: "6/28/2019"
output: 
  pdf_document:
    keep_tex: true
    fig_caption: yes
params: 
  input: NA
  dsl: NA
  figure_folder: NA
  REG: NA
bibliography: bibliography.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
input <- params$input
dsl <- params$dsl
figure_folder <- params$figure_folder
get_data_id <- function(dsList) {
  if (is.null(dsList) | length(dsList) == 0)
    return(NULL)

  paste(get_funcId(dsList), get_dim(dsList), sep = '-')
}
REG <- params$REG
```

```{asis, echo=input$Report.Introduction}
## Introduction

This report has been automatically generated by the IOHanalyzer [@IOHprofiler].

```

## Fixed-target view

```{r overview, results='asis', eval=input$Report.FV.Overview}
asis_output("### Overview of selected function / dimension pairs")
cat('\n')
for (dim in input$`Report.FV.Overview-DIM` ) {
  for (fid in input$`Report.FV.Overview-FuncId` ) {
    x <- paste0("### F", fid, " ", dim, "D \n")
    cat(x)
    cat('\n')
    dsl_sub <- subset(dsl, DIM == dim && funcId == fid && algId %in% input$`Report.FV.Overview-Alg` )
    p <- kable(get_FV_overview(dsl_sub), caption = paste0("Overview of selected algorithms on F", fid, " in ", dim, "D"), format = 'latex') %>% kable_styling(latex_options=c("scale_down", "hold_position"))
    print(p)
    cat('\n')

  }
}
```

```{r statistics, results='asis', eval=input$Report.FV.Statistics}
asis_output("### Runtime statistics of selected function / dimension pairs")
cat('\n')
for (dim in input$`Report.FV.Statistics-DIM` ) {
  for (fid in input$`Report.FV.Statistics-FuncId` ) {
    x <- paste0("### F", fid, " ", dim, "D \n")
    cat(x)
    cat('\n')
    dsl_sub <- subset(dsl, DIM == dim && funcId == fid && algId %in% input$`Report.FV.Statistics-Alg`)
    name <- get_data_id(dsl_sub)
    rts <- get_runtimes(dsl_sub)
    tryCatch(
      {
      rt_seq <- seq_RT(rts, as.numeric(REG$RTSummary.Statistics.Min[[name]]), as.numeric(REG$RTSummary.Statistics.Max[[name]]), 
                       by = as.numeric(REG$RTSummary.Statistics.Step[[name]])) 
    },
    error = function(e) { rt_seq <- seq_RT(rts, length.out = 10)}
    )
    p <- kable(get_FV_summary(dsl_sub, rt_seq), 
               caption = paste0("Runtime statistics of selected algorithms on F", fid, " in ", dim, "D"), 
               format = 'latex') %>% 
      kable_styling(latex_options=c("scale_down", "hold_position"))
    print(p)
    cat('\n')

  }
}
```
 
```{r single_erts, eval=input$Report.FV.Single_ERT, results='hide', include=F}
# asis_output("### Runtime plots of selected function / dimension pairs")
# cat('  \n')
# for (dim in input$`Report.FV.Single_ERT-DIM` ) {
#   for (fid in input$`Report.FV.Single_ERT-FuncId` ) {
#     x <- paste0("### F", fid, " ", dim, "D   \n")
#     cat(x)
#     cat('  \n')
#     dsl_sub <- subset(dsl, DIM == dim && funcId == fid && algId %in% input$`Report.FV.Single_ERT-Alg`)
#     p <- Plot.FV.Single_Func(dsl_sub)
#     file_path <- paste0("ERT_single_F", fid, "D", dim, ".pdf")
#     save_plotly(p, file.path(figure_folder, file_path), format = 'pdf')
#     cat("![](",file_path,")")
#     cat('  \n')
#   }
# }
out <- NULL
for (dim in input$`Report.FV.Single_ERT-DIM` ) {
  for (fid in input$`Report.FV.Single_ERT-FuncId` ) {
    algs = input$`Report.FV.Single_ERT-Alg`
    env = new.env()
    out <- invisible(c(out,knit_child("Single_ERT.Rmd")))
  }
}
```

`r if(input$Report.FV.Single_ERT) paste(out, collapse='\n')`

```{r multi_erts, eval=input$Report.FV.Multi_ERT, results='hide', include=F}
out <- NULL
for (dim in input$`Report.FV.Multi_ERT-DIM` ) {
  algs = input$`Report.FV.Multi_ERT-Alg`
  env = new.env()
  out <- invisible(c(out,knit_child("Multi_ERT.Rmd")))
}
```

`r if(input$Report.FV.Multi_ERT) paste(out, collapse='\n')`

```{r ranking_erts, eval=input$Report.FV.Rank, results='hide', include=F}
out <- NULL
for (dim in input$`Report.FV.Rank-DIM` ) {
  algs = input$`Report.FV.Rank-Alg`
  env = new.env()
  out <- invisible(c(out,knit_child("FV_Rank.Rmd")))
}
```

`r if(input$Report.FV.Rank) paste(out, collapse='\n')`

# References
